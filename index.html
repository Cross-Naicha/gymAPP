<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rutina de hoy</title>
  <style>
    :root{
      --bg:#0b0c10;--card:#121318;--ink:#e8eaf1;--muted:#a9b0c0;--accent:#7c5cff;--border:#232533;
      --shadow:0 10px 25px rgba(0,0,0,.35);--radius:14px;
    }
    @media (prefers-color-scheme: light){
      :root{--bg:#f6f7fb;--card:#fff;--ink:#151824;--muted:#57607a;--border:#e6e8ef;--shadow:0 10px 25px rgba(0,0,0,.08)}
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Roboto,Arial;
      background: var(--bg); color: var(--ink); padding:20px; line-height:1.35;
    }
    header{
      max-width:980px;margin:0 auto 16px;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap
    }
    h1{font-size:clamp(22px,3.2vw,30px);margin:0}
    .status{padding:8px 12px;border-radius:999px;background:linear-gradient(180deg,rgba(88,213,166,.2),transparent)}
    .status.err{background:linear-gradient(180deg,rgba(255,99,99,.25),transparent)}
    .wrap{max-width:980px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}

    /* Tabla (vista desktop) */
    .table-wrap{overflow:auto}
    table{width:100%;border-collapse:collapse;min-width:720px}
    thead th{
      position:sticky;top:0;background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,0));
      backdrop-filter:blur(6px);text-align:left;font-size:.9rem;color:var(--muted)
    }
    th,td{padding:12px 10px;border-bottom:1px solid var(--border)}
    tbody tr:hover{background:rgba(124,92,255,.08)}
    .ex{font-weight:700;cursor:pointer}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;background:rgba(124,92,255,.15);color:#cfc7ff;font-size:.8rem;margin-left:6px}

    /* Buscador */
    .search{display:flex;gap:8px;align-items:center}
    .search input{
      flex:1; max-width:280px; padding:10px 12px; border-radius:12px; border:1px solid var(--border);
      background:var(--card); color:var(--ink); outline:none;
    }
    .search input:focus{box-shadow:0 0 0 3px rgba(124,92,255,.25)}
    .search button{
      border:1px solid var(--border); background:var(--card); color:var(--muted);
      border-radius:12px; padding:8px 10px; cursor:pointer;
    }
    .search button:hover{color:var(--ink)}

    /* Lista vertical (vista mÃ³vil) */
    .list-wrap{display:none}
    .list{display:grid; gap:12px; padding:12px}
    .ex-card{padding:14px; border-radius:var(--radius); border:1px solid var(--border); background:var(--card)}
    .ex-head{display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px}
    .ex-name{font-weight:800; cursor:pointer}
    .sets{display:grid; gap:6px}
    .setline{display:flex; justify-content:space-between; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:0.95rem}
    .setline .label{opacity:.8}
    .muted{color:var(--muted)}

    /* Responsivo: en pantallas chicas, se oculta la tabla y se muestra la lista */
    @media (max-width: 680px){
      .table-wrap{display:none !important}
      .list-wrap{display:block}
      .wrap{max-width:720px}
    }
  </style>
</head>
<body>
  <header>
    <h1>Rutina de hoy</h1>

    <div class="search" role="search">
      <input id="search" type="search" placeholder="Filtrar ejercicioâ€¦" aria-label="Filtrar ejercicio" />
      <button id="clearBtn" type="button" title="Limpiar" aria-label="Limpiar filtro">Ã—</button>
    </div>

    <div id="status" class="status">Cargandoâ€¦</div>
  </header>

  <div class="wrap">
    <!-- Vista tabla (desktop) -->
    <section class="card table-wrap" id="tableCard" style="display:none">
      <table id="routineTable" aria-label="Tabla de rutina">
        <thead>
          <tr>
            <th>Ejercicio</th>
            <th>S1 Reps</th><th>S1 Peso</th>
            <th>S2 Reps</th><th>S2 Peso</th>
            <th>S3 Reps</th><th>S3 Peso</th>
            <th>S4 Reps</th><th>S4 Peso</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Vista lista (mÃ³vil) -->
    <section class="list-wrap" id="listCard" style="display:none">
      <div class="list" id="listView" aria-label="Lista de ejercicios"></div>
    </section>
  </div>

  <script>
    // âš™ï¸ Config: dÃ³nde estÃ¡ tu JSON (mismo folder que este HTML)
    const DEFAULT_DATA_URL = 'routine.json';

    const status = document.getElementById('status');
    const tableCard = document.getElementById('tableCard');
    const tbody = document.querySelector('#routineTable tbody');

    const listCard = document.getElementById('listCard');
    const listView = document.getElementById('listView');

    const searchInput = document.getElementById('search');
    const clearBtn = document.getElementById('clearBtn');

    function setStatus(text, ok = true){
      status.textContent = text;
      status.className = ok ? 'status' : 'status err';
    }

    function formatNumber(n){
      if (n == null || n === '') return 'â€”';
      const num = Number(n);
      if (!isFinite(num)) return String(n);
      return num.toFixed(2).replace(/\.00$/,'').replace(/(\.\d*[1-9])0$/,'$1');
    }

    function normalizeExerciseName(name){
      return name.replace(/\S+/g, w => w[0].toUpperCase() + w.slice(1));
    }

    // --------- Render tabla (desktop) ----------
    function renderTable(obj){
      tbody.innerHTML = '';
      const entries = Object.entries(obj);
      if (entries.length === 0){ tableCard.style.display = 'none'; return; }
      tableCard.style.display = '';
      for (const [name, vals] of entries){
        const tr = document.createElement('tr');
        tr.dataset.name = name;

        const tdName = document.createElement('td');
        tdName.className = 'ex';
        tdName.textContent = normalizeExerciseName(name);

        const bodyweight = (['w1','w2','w3','w4'].some(k => Number(vals?.[k]) === 0));
        if (bodyweight){
          const tag = document.createElement('span');
          tag.className='tag'; tag.textContent='BW';
          tdName.appendChild(tag);
        }
        tr.appendChild(tdName);

        for (let i=1;i<=4;i++){
          const r = vals?.['r'+i];
          const w = vals?.['w'+i];
          const tdR = document.createElement('td'); tdR.textContent = formatNumber(r);
          const tdW = document.createElement('td'); tdW.textContent = formatNumber(w);
          tr.appendChild(tdR); tr.appendChild(tdW);
        }
        tbody.appendChild(tr);
      }
    }

    // --------- Render lista (mÃ³vil) ----------
    function renderList(obj){
      listView.innerHTML = '';
      const entries = Object.entries(obj);
      if (entries.length === 0){ listCard.style.display = 'none'; return; }
      listCard.style.display = '';
      for (const [name, vals] of entries){
        const card = document.createElement('article');
        card.className = 'ex-card';
        card.dataset.name = name;

        const head = document.createElement('div');
        head.className = 'ex-head';

        const title = document.createElement('div');
        title.className = 'ex-name';
        title.textContent = normalizeExerciseName(name);

        const bodyweight = (['w1','w2','w3','w4'].some(k => Number(vals?.[k]) === 0));
        if (bodyweight){
          const tag = document.createElement('span');
          tag.className='tag'; tag.textContent='BW';
          title.appendChild(tag);
        }

        head.appendChild(title);
        card.appendChild(head);

        const sets = document.createElement('div');
        sets.className = 'sets';

        for (let i=1;i<=4;i++){
          const r = vals?.['r'+i];
          const w = vals?.['w'+i];
          // Solo mostrar lÃ­neas que tengan al menos reps o peso
          if (r != null || w != null){
            const line = document.createElement('div');
            line.className = 'setline';
            const left = document.createElement('span');
            left.className = 'label';
            left.textContent = `S${i}`;
            const right = document.createElement('span');
            right.textContent = `${formatNumber(r)} / ${formatNumber(w)}`;
            line.appendChild(left);
            line.appendChild(right);
            sets.appendChild(line);
          }
        }

        // Si no hay ninguna serie informada, muestro una fila vacÃ­a para que no quede â€œen blancoâ€
        if (!sets.children.length){
          const line = document.createElement('div');
          line.className = 'setline muted';
          line.textContent = 'Sin series';
          sets.appendChild(line);
        }

        card.appendChild(sets);
        listView.appendChild(card);
      }
    }

    // --------- Filtro (aplica a ambas vistas) ----------
    function normalize(str){
      return (str ?? '').toString().toLowerCase()
        .normalize('NFD').replace(/\p{Diacritic}/gu,'');
    }

    function applyFilter(term){
      const q = normalize(term);
      let shown = 0;

      // Filtra filas de la tabla
      for (const tr of tbody.querySelectorAll('tr')){
        const name = tr.dataset.name || tr.querySelector('.ex')?.textContent || '';
        const hit = normalize(name).includes(q);
        tr.style.display = hit ? '' : 'none';
      }

      // Filtra tarjetas de la lista
      for (const card of listView.querySelectorAll('.ex-card')){
        const name = card.dataset.name || card.querySelector('.ex-name')?.textContent || '';
        const hit = normalize(name).includes(q);
        card.style.display = hit ? '' : 'none';
        if (hit) shown++;
      }

      // Si estÃ¡s en mÃ³vil, el conteo visible serÃ¡ por tarjetas; igual sirve para estado
      const anyVisible = shown > 0;
      tableCard.style.display = ''; // controlado por media query
      listCard.style.display = '';  // controlado por media query
      setStatus(anyVisible ? `Mostrando ${shown} ejercicio(s)` : 'Sin resultados', anyVisible);
    }

    function bindNameClicks(){
      // Click en nombres (ambas vistas) para autocompletar filtro
      for (const el of document.querySelectorAll('.ex, .ex-name')){
        el.addEventListener('click', () => {
          // Solo el texto del nombre, sin el tag BW
          const nameOnly = el.childNodes[0]?.nodeValue?.trim() || el.textContent.trim();
          searchInput.value = nameOnly;
          applyFilter(nameOnly);
          searchInput.focus();
        });
      }
    }

    // Eventos del buscador
    searchInput.addEventListener('input', () => applyFilter(searchInput.value));
    clearBtn.addEventListener('click', () => {
      searchInput.value=''; applyFilter(''); searchInput.focus();
    });
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape'){
        searchInput.value=''; applyFilter(''); searchInput.focus();
      }
    });

    // Soporte querystring: ?q=prensa
    function initQueryFilter(){
      const q = new URLSearchParams(location.search).get('q');
      if (q){
        searchInput.value = q;
        applyFilter(q);
      } else {
        applyFilter('');
      }
    }

    // --------- Carga de datos ----------
    async function loadJSON(url){
      try{
        setStatus('Cargandoâ€¦');
        const res = await fetch(url, { cache: 'no-cache' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        renderTable(data);
        renderList(data);
        bindNameClicks();
        initQueryFilter();

        setStatus('Cargado âœ“');
      }catch(err){
        console.error(err);
        tableCard.style.display = 'none';
        listCard.style.display = 'none';
        setStatus('Error: ' + err.message, false);
      }
    }

    // ðŸš€ carga inicial
    loadJSON(DEFAULT_DATA_URL);
  </script>
</body>
</html>